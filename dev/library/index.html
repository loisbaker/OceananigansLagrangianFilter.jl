<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Library · OceananigansLagrangianFilter.jl</title><meta name="title" content="Library · OceananigansLagrangianFilter.jl"/><meta property="og:title" content="Library · OceananigansLagrangianFilter.jl"/><meta property="twitter:title" content="Library · OceananigansLagrangianFilter.jl"/><meta name="description" content="Documentation for OceananigansLagrangianFilter.jl."/><meta property="og:description" content="Documentation for OceananigansLagrangianFilter.jl."/><meta property="twitter:description" content="Documentation for OceananigansLagrangianFilter.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">OceananigansLagrangianFilter.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../quick_start/">Quick start</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../theory/Eulerian_Lagrangian_definitions/">Eulerian and Lagrangian averaging</a></li><li><a class="tocitem" href="../theory/filtering_PDEs/">Background: PDEs for Lagrangian filtering</a></li><li><a class="tocitem" href="../theory/online_equations/">Online Lagrangian filtering equations</a></li><li><a class="tocitem" href="../theory/offline_equations/">Offline Lagrangian filtering equations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Online filtering</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../online_filtering/online_implementation/">Online filtering implementation</a></li><li><a class="tocitem" href="../online_filtering/choosing_online_filters/">Choosing online filters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Offline filtering</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../offline_filtering/offline_implementation/">Offline filtering implementation</a></li><li><a class="tocitem" href="../offline_filtering/choosing_offline_filters/">Choosing offline filters</a></li><li><a class="tocitem" href="../offline_filtering/offline_how_it_works/">How it works</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../literated/online_filter_geostrophic_adjustment/">Geostrophic adjustment online</a></li><li><a class="tocitem" href="../literated/offline_filter_geostrophic_adjustment/">Geostrophic adjustment offline</a></li><li><a class="tocitem" href="../literated/offline_filter_shallow_water_IO/">Shallow water inertial oscillation offline</a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li><li class="is-active"><a class="tocitem" href>Library</a><ul class="internal"><li><a class="tocitem" href="#OceananigansLagrangianFilter.OnlineLagrangianFilter"><span>OceananigansLagrangianFilter.OnlineLagrangianFilter</span></a></li><li><a class="tocitem" href="#OceananigansLagrangianFilter.OfflineLagrangianFilter"><span>OceananigansLagrangianFilter.OfflineLagrangianFilter</span></a></li><li><a class="tocitem" href="#OceananigansLagrangianFilter.Utils"><span>OceananigansLagrangianFilter.Utils</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Library</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Library</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://loisbaker.github.io/OceananigansLagrangianFilter.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="OceananigansLagrangianFilter.jl-Library"><a class="docs-heading-anchor" href="#OceananigansLagrangianFilter.jl-Library">OceananigansLagrangianFilter.jl Library</a><a id="OceananigansLagrangianFilter.jl-Library-1"></a><a class="docs-heading-anchor-permalink" href="#OceananigansLagrangianFilter.jl-Library" title="Permalink"></a></h1><p>Documenting the public user interface.</p><h2 id="OceananigansLagrangianFilter.OnlineLagrangianFilter"><a class="docs-heading-anchor" href="#OceananigansLagrangianFilter.OnlineLagrangianFilter">OceananigansLagrangianFilter.OnlineLagrangianFilter</a><a id="OceananigansLagrangianFilter.OnlineLagrangianFilter-1"></a><a class="docs-heading-anchor-permalink" href="#OceananigansLagrangianFilter.OnlineLagrangianFilter" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.OnlineLagrangianFilter.OnlineFilterConfig" href="#OceananigansLagrangianFilter.OnlineLagrangianFilter.OnlineFilterConfig"><code>OceananigansLagrangianFilter.OnlineLagrangianFilter.OnlineFilterConfig</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">OnlineFilterConfig(;

)</code></pre><p>A configuration object for online filtering.</p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.OnlineLagrangianFilter.OnlineFilterConfig-Tuple{}" href="#OceananigansLagrangianFilter.OnlineLagrangianFilter.OnlineFilterConfig-Tuple{}"><code>OceananigansLagrangianFilter.OnlineLagrangianFilter.OnlineFilterConfig</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">OnlineFilterConfig(; grid::AbstractGrid,
                        output_filename::String = &quot;online_filtered_output&quot;,
                        var_names_to_filter::Tuple{Vararg{String}},
                        velocity_names::Tuple{Vararg{String}},
                        N::Union{Int, Nothing} = nothing,
                        freq_c::Union{Int, Nothing} = nothing,
                        filter_params::Union{NamedTuple, Nothing} = nothing,
                        map_to_mean::Bool = true,
                        compute_mean_velocities::Bool = true,
                        npad::Int = 5,
                        filter_mode::String = &quot;online&quot;
                        )</code></pre><p>Constructs a configuration object for offline Lagrangian filtering of Oceananigans data. This function validates the input data file, time specifications, and filter parameters before creating the <code>OfflineFilterConfig</code> object.</p><p><strong>Keyword arguments</strong></p><ul><li><code>grid</code>: (required) The grid for the simulation. If <code>nothing</code>, the grid is inferred from the <code>original_data_filename</code> (preferred option)</li><li><code>output_filename</code>: The filename for the output of the online filtered data. Default: <code>&quot;online_filtered_output&quot;</code>.</li><li><code>var_names_to_filter</code>: (required) A <code>Tuple</code> of <code>String</code>s specifying the names of the tracer variables to be filtered.</li><li><code>velocity_names</code>: (required) A <code>Tuple</code> of <code>String</code>s specifying the names of the velocity fields in the data file to be used for advection.</li><li><code>N</code>, <code>freq_c</code>: Parameters for a Butterworth filter. <code>N</code> is the order of the filter, and <code>freq_c</code> is the cutoff frequency.   These are used to automatically generate <code>filter_params</code> if not provided. Must be specified together if <code>filter_params</code> is not given.</li><li><code>filter_params</code>: A <code>NamedTuple</code> containing the coefficients for a custom filter. Only filter<em>params OR <code>N</code> and `freq</em>c` should be given.</li><li><code>map_to_mean</code>: A <code>Bool</code> indicating whether to map filtered data to the mean position (i.e. calculate generalised Lagrangian mean). Default: <code>true</code>.</li><li><code>compute_mean_velocities</code>: A <code>Bool</code> indicating whether to compute the mean velocities from the maps. Default: <code>true</code>.</li><li><code>npad</code>: The number of cells to pad the interpolation to mean position, used when there are periodic boundary conditions. Default: <code>5</code>.</li><li><code>compute_Eulerian_filter</code>: A <code>Bool</code> indicating whether to also compute an Eulerian-mean-based filter for comparison. Default: <code>false</code>.</li><li><code>filter_mode</code>: A <code>String</code> indicating whether to run the filter in &quot;offline&quot; or &quot;online&quot; mode. Default: &quot;online&quot;. TODO use multiple dispatch for this instead.</li></ul><p><strong>Example:</strong></p><pre><code class="language-julia hljs">using OceananigansLagrangianFilter
using Oceananigans.Units

Nx = 50
Nz = 20
L = 10kilometers 
H = 100meters 

grid = RectilinearGrid(CPU(),size = (Nx, Nz), 
                       x = (-L/2, L/2),
                       z = (-H, 0),
                       topology = (Periodic, Flat, Bounded))

filter_config = OnlineFilterConfig( grid = grid,
                                    output_filename = &quot;test_filter.jld2&quot;,
                                    var_names_to_filter = (&quot;b&quot;,&quot;T&quot;), 
                                    velocity_names = (&quot;u&quot;,&quot;w&quot;),
                                    N = 2,
                                    freq_c = 1e-4/2)

# output

[ Info: Setting filter parameters to use Butterworth order 2, cutoff frequency 5.0e-5
OnlineFilterConfig(50×1×20 RectilinearGrid{Float64, Periodic, Flat, Bounded} on CPU with 3×0×3 halo
├── Periodic x ∈ [-5000.0, 5000.0) regularly spaced with Δx=200.0
├── Flat y                         
└── Bounded  z ∈ [-100.0, 0.0]     regularly spaced with Δz=5.0, &quot;test_filter.jld2&quot;, (&quot;b&quot;, &quot;T&quot;), (&quot;u&quot;, &quot;w&quot;), (a1 = 1.421067568548072e-20, b1 = -7.071067811865475e-5, c1 = 3.535533905932738e-5, d1 = -3.535533905932738e-5, N_coeffs = 1), true, true, 5, &quot;online&quot;)
</code></pre></div></section></article><h2 id="OceananigansLagrangianFilter.OfflineLagrangianFilter"><a class="docs-heading-anchor" href="#OceananigansLagrangianFilter.OfflineLagrangianFilter">OceananigansLagrangianFilter.OfflineLagrangianFilter</a><a id="OceananigansLagrangianFilter.OfflineLagrangianFilter-1"></a><a class="docs-heading-anchor-permalink" href="#OceananigansLagrangianFilter.OfflineLagrangianFilter" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.OfflineLagrangianFilter.OfflineFilterConfig" href="#OceananigansLagrangianFilter.OfflineLagrangianFilter.OfflineFilterConfig"><code>OceananigansLagrangianFilter.OfflineLagrangianFilter.OfflineFilterConfig</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">OfflineFilterConfig(;
    
)</code></pre><p>A configuration object for <code>apply_offline_filter</code>.</p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.OfflineLagrangianFilter.OfflineFilterConfig-Tuple{}" href="#OceananigansLagrangianFilter.OfflineLagrangianFilter.OfflineFilterConfig-Tuple{}"><code>OceananigansLagrangianFilter.OfflineLagrangianFilter.OfflineFilterConfig</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">OfflineFilterConfig(; original_data_filename::String,
                    var_names_to_filter::Tuple{Vararg{String}},
                    velocity_names::Tuple{Vararg{String}},
                    T_start::Union{Real,Nothing} = nothing,
                    T_end::Union{Real,Nothing} = nothing,
                    T::Union{Real,Nothing} = nothing,
                    architecture::AbstractArchitecture = CPU(),
                    T_out::Union{Real,Nothing} = nothing,
                    N::Union{Int, Nothing} = nothing,
                    freq_c::Union{Int, Nothing} = nothing,
                    filter_params::Union{NamedTuple, Nothing} = nothing,
                    Δt::Union{Real,Nothing} = nothing,
                    backend::AbstractInMemoryBackend = InMemory(4),
                    map_to_mean::Bool = true,
                    forward_output_filename::String = &quot;forward_output.jld2&quot;,
                    backward_output_filename::String = &quot;backward_output.jld2&quot;,
                    output_filename::String = &quot;filtered_output.jld2&quot;,
                    npad::Int = 5,
                    compute_mean_velocities::Bool = true,
                    delete_intermediate_files::Bool = true,
                    compute_Eulerian_filter::Bool = false,
                    output_netcdf::Bool = false,
                    output_original_data::Bool = true
                    advection::AbstractAdvectionScheme = WENO(),
                    grid::Union{AbstractGrid, Nothing} = nothing,
                    filter_mode::String = &quot;offline&quot;)</code></pre><p>Constructs a configuration object for offline Lagrangian filtering of Oceananigans data. This function validates the input data file, time specifications, and filter parameters before creating the <code>OfflineFilterConfig</code> object.</p><p><strong>Keyword arguments</strong></p><ul><li><code>original_data_filename</code>: (required) The path to the JLD2 file containing the original Oceananigans output data.</li><li><code>var_names_to_filter</code>: (required) A <code>Tuple</code> of <code>String</code>s specifying the names of the tracer variables to be filtered.</li><li><code>velocity_names</code>: (required) A <code>Tuple</code> of <code>String</code>s specifying the names of the velocity fields in the data file to be used for advection.</li><li><code>T_start</code>: Start time for the filter. Must be within the time range of the data. If not given, defaults to either T_end - T (if they are given), or the start time of the original data.</li><li><code>T_end</code>: End time for the filter. Must be within the time range of the data. If not given, defaults to either T<em>start + T (after T</em>start given or computed, if T is given), or the end time of the original data.</li><li><code>T</code>: Duration of the filtering. If not given, defaults to T<em>end - T</em>start (after T<em>start and T</em>end are given or computed).</li><li><code>architecture</code>: The architecture (CPU or GPU) to be used for the filtering computation. Default: <code>CPU()</code>.</li><li><code>T_out</code>: The output time step for the filtered data. If <code>nothing</code>, it defaults to the time step of the original data.</li><li><code>N</code>, <code>freq_c</code>: Parameters for a Butterworth squared filter. <code>N</code> is the order of the filter, and <code>freq_c</code> is the cutoff frequency.   These are used to automatically generate <code>filter_params</code> if not provided. Must be specified together if <code>filter_params</code> is not given.</li><li><code>filter_params</code>: A <code>NamedTuple</code> containing the coefficients for a custom filter. Only filter<em>params OR <code>N</code> and `freq</em>c` should be given.</li><li><code>Δt</code>: The time step for the internal Lagrangian filter simulation. If <code>nothing</code>, it defaults to <code>T_out / 10</code>, but this may not be appropriate.</li><li><code>backend</code>: The backend for loading <code>FieldTimeSeries</code> data. See <code>Oceananigans.Fields.FieldTimeSeries</code>. Default: <code>InMemory(4)</code>.</li><li><code>map_to_mean</code>: A <code>Bool</code> indicating whether to map filtered data to the mean position (i.e. calculate generalised Lagrangian mean). Default: <code>true</code>.</li><li><code>forward_output_filename</code>: The filename for the output of the forward filter pass. Default: <code>&quot;forward_output.jld2&quot;</code>.</li><li><code>backward_output_filename</code>: The filename for the output of the backward filter pass. Default: <code>&quot;backward_output.jld2&quot;</code>.</li><li><code>output_filename</code>: The filename for the final combined and mapped output. Default: <code>&quot;filtered_output.jld2&quot;</code>.</li><li><code>npad</code>: The number of cells to pad the interpolation to mean position, used when there are periodic boundary conditions. Default: <code>5</code>.</li><li><code>compute_mean_velocities</code>: A <code>Bool</code> indicating whether to compute the mean velocities from the maps. Default: <code>true</code>.</li><li><code>delete_intermediate_files</code>: A <code>Bool</code> indicating whether to delete <code>forward_output.jld2</code> and <code>backward_output.jld2</code> after the final combined file is created. Default: <code>true</code>.</li><li><code>compute_Eulerian_filter</code>: A <code>Bool</code> indicating whether to also compute an Eulerian-mean-based filter for comparison. Default: <code>false</code>.</li><li><code>output_netcdf</code>: A <code>Bool</code> indicating whether to also convert the final JLD2 output file to a NetCDF file. Default: <code>false</code>.<ul><li><code>output_original_data</code>: A <code>Bool</code> indicating whether to include the original data in the final output file for comparison. Default: <code>true</code>.</li></ul></li><li><code>advection</code>: The advection scheme to use for the Lagrangian filter simulation. Default: <code>WENO()</code>. Using lower-order schemes may be a source of error.</li><li><code>grid</code>: The grid for the simulation. If <code>nothing</code>, the grid is inferred from the <code>original_data_filename</code> (preferred option)</li><li><code>filter_mode</code>: A <code>String</code> indicating whether to run the filter in &quot;offline&quot; or &quot;online&quot; mode. Default: &quot;offline&quot;. TODO use multiple dispatch for this instead.</li></ul><p><strong>Example:</strong></p><pre><code class="language-julia hljs">using OceananigansLagrangianFilter
using Oceananigans.Units
path_to_sim = &quot;../test/data/reference_sim.jld2&quot;
filter_config = OfflineFilterConfig(original_data_filename=path_to_sim, 
                                    output_filename = &quot;output_file.jld2&quot;, 
                                    var_names_to_filter = (&quot;b&quot;,), 
                                    velocity_names = (&quot;u&quot;,&quot;w&quot;), 
                                    architecture = CPU(), 
                                    Δt = 20minutes, 
                                    T_out = 1hour, 
                                    N = 2, 
                                    freq_c = 1e-4/2, 
                                    compute_mean_velocities = true, 
                                    output_netcdf = true, 
                                    delete_intermediate_files = true, 
                                    compute_Eulerian_filter = true) 

# output

[ Info: Filter interval will be from T_start=0.0 to T_end=86400.0, duration T=86400.0
[ Info: Setting filter parameters to use Butterworth squared, order 2, cutoff frequency 5.0e-5
OfflineFilterConfig(&quot;../test/data/reference_sim.jld2&quot;, (&quot;b&quot;,), (&quot;u&quot;, &quot;w&quot;), 0.0, 86400.0, 86400.0, CPU(), 3600.0, (a1 = 1.767766952966369e-5, b1 = 1.767766952966369e-5, c1 = 3.535533905932738e-5, d1 = 3.535533905932738e-5, N_coeffs = 1), 1200.0, InMemory{Int64}(1, 4), true, &quot;forward_output.jld2&quot;, &quot;backward_output.jld2&quot;, &quot;output_file.jld2&quot;, 5, true, true, true, true, true, WENO{3, Float64, Float32}(order=5)
├── buffer_scheme: WENO{2, Float64, Float32}(order=3)
└── advection_velocity_scheme: Centered(order=4), 10×1×10 RectilinearGrid{Float64, Periodic, Flat, Bounded} on CPU with 3×0×3 halo
├── Periodic x ∈ [-5000.0, 5000.0) regularly spaced with Δx=1000.0
├── Flat y                         
└── Bounded  z ∈ [-100.0, 0.0]     regularly spaced with Δz=10.0, &quot;offline&quot;)
</code></pre></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.OfflineLagrangianFilter.run_offline_Lagrangian_filter-Tuple{Any}" href="#OceananigansLagrangianFilter.OfflineLagrangianFilter.run_offline_Lagrangian_filter-Tuple{Any}"><code>OceananigansLagrangianFilter.OfflineLagrangianFilter.run_offline_Lagrangian_filter</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">run_offline_Lagrangian_filter(config::OfflineFilterConfig)</code></pre><p>Runs an offline Lagrangian filter on an Oceananigans <code>FieldTimeSeries</code> dataset as configured by <code>config</code>.</p><p>This function performs a series of steps to filter the data:</p><ol><li><strong>Prepare data on disk</strong>: The input data is copied and manipulated on disk to be suitable for the forward and backward Lagrangian simulations.</li><li><strong>Run forward simulation</strong>: A <code>LagrangianFilter</code> model is created and run forward in time to compute the first half of the filter contributions.</li><li><strong>Run backward simulation</strong>: The input data is re-prepared for a backward pass, and the simulation is run a second time to compute the remaining contributions.</li><li><strong>Combine results</strong>: The forward and backward simulation outputs are summed to produce the final filtered data.</li><li><strong>Post-processing</strong>: Optional post-processing steps are performed, including regridding the data to the mean position, computing a comparative Eulerian filter, and converting the output file to NetCDF.</li><li><strong>Cleanup</strong>: Intermediate files are removed to save disk space.</li></ol><p><strong>Arguments</strong></p><ul><li><code>config</code>: An instance of <code>OfflineFilterConfig</code> that specifies all parameters and file paths for the filtering process.</li></ul></div></section></article><h2 id="OceananigansLagrangianFilter.Utils"><a class="docs-heading-anchor" href="#OceananigansLagrangianFilter.Utils">OceananigansLagrangianFilter.Utils</a><a id="OceananigansLagrangianFilter.Utils-1"></a><a class="docs-heading-anchor-permalink" href="#OceananigansLagrangianFilter.Utils" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.compute_Eulerian_filter!-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.compute_Eulerian_filter!-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.compute_Eulerian_filter!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_Eulerian_filter!(config::AbstractConfig)</code></pre><p>Computes the Eulerian filter for specified variables and writes the results to a combined output file. This function performs a direct, convolution-style filtering of a time series by applying a weighting function to the data at each time step.</p><p>The function iterates through each variable to be filtered:</p><ol><li><strong>Reads data</strong>: The entire time series of the variable is read from the  JLD2 file.</li><li><strong>Applies weighting</strong>: At each output time, a weighting function <code>G</code> is  computed and applied to the entire time series. The weighted data is summed  to produce the filtered field.</li><li><strong>Writes output</strong>: The resulting filtered field is saved back to the  same JLD2 file in a new group with the <code>_Eulerian_filtered</code> suffix.</li></ol><p>This method serves as a benchmark for comparison with the main Lagrangian filter.</p><p><strong>Arguments</strong></p><ul><li><code>config</code>: An instance of <code>AbstractConfig</code> containing the file path, variable names, and filter parameters.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.compute_time_shift!-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.compute_time_shift!-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.compute_time_shift!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_time_shift!(config::AbstractConfig)</code></pre><p>Computes the time shift for an online filter based on its coefficients and writes the shifted time series to the output file.</p><p>This function is only applicable for online filtering. The time shift is computed as the time delay introduced by the filter&#39;s transfer function. This new time series is stored in a new group called <code>timeseries/t_shifted</code> within the output JLD2 file.</p><p><strong>Arguments</strong></p><ul><li><code>config</code>: A configuration object of type <code>OfflineFilterConfig</code> which contains the <code>filter_mode</code>, <code>output_filename</code>, and <code>filter_params</code> (filter coefficients).</li></ul><p><strong>Throws</strong></p><ul><li><code>error</code>: If <code>config.filter_mode</code> is not <code>&quot;online&quot;</code>. The time shift for offline (forward-backward) filtering is zero by definition due to an even weight function.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.create_filtered_vars-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.create_filtered_vars-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.create_filtered_vars</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_filtered_vars(config::AbstractConfig)</code></pre><p>Creates a <code>Tuple</code> of <code>Symbol</code>s representing the names of the filtered tracer variables.</p><ul><li>For a single-exponential filter (<code>N_coeffs = 0.5</code>), the function generates names with a <code>_C1</code> suffix.</li><li>For a multi-coefficient filter (<code>N_coeffs &gt; 0.5</code>), it generates pairs of names for each coefficient, suffixed with <code>_C#</code> and <code>_S#</code>, where <code>#</code> is the coefficient index.</li></ul><p>If <code>map_to_mean</code> or <code>compute_mean_velocities</code> is enabled in the configuration, additional symbols are created for the spatial mapping variables corresponding to each velocity component, prefixed with <code>xi_</code> and suffixed with the corresponding coefficient names.</p><p><strong>Arguments</strong></p><ul><li><code>config</code>: An instance of <code>AbstractConfig</code> containing the names of the variables to filter, the filter parameters, and the <code>map_to_mean</code> and <code>compute_mean_velocities</code> booleans.</li></ul><p><strong>Returns</strong></p><p>A <code>Tuple</code> of <code>Symbol</code>s representing the names of the filtered variables to be used as tracers in the simulation.</p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.create_forcing-Tuple{Tuple{Vararg{Symbol}}, OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.create_forcing-Tuple{Tuple{Vararg{Symbol}}, OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.create_forcing</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_forcing(filtered_vars::Tuple{Vararg{Symbol}}, config::AbstractConfig)</code></pre><p>Creates a <code>NamedTuple</code> of forcing functions for each filtered variable and, if enabled, for the spatial mapping variables. These forcing terms are used to numerically integrate the filter equations.</p><p>The function handles two cases: a single-exponential filter (<code>N_coeffs = 0.5</code>) and a multi-coefficient Butterworth squared filter (<code>N_coeffs &gt; 0.5</code>).</p><ul><li>For standard filtered variables, the forcing is a combination of terms derived from the filter&#39;s coefficients and a term from the original data.</li><li>For spatial mapping variables (if <code>map_to_mean</code> or <code>compute_mean_velocities</code> is true), the forcing includes terms derived from the filter&#39;s coefficients and a term from the original velocity data.</li></ul><p><strong>Arguments</strong></p><ul><li><code>filtered_vars</code>: A <code>Tuple</code> of <code>Symbol</code>s representing the names of the filtered variables.</li><li><code>config</code>: An instance of <code>AbstractConfig</code> containing the names of the variables to be filtered, velocity names, and the filter parameters.</li></ul><p><strong>Returns</strong></p><p>A <code>NamedTuple</code> where each key is a variable name from <code>filtered_vars</code> and each value is a <code>Tuple</code> of the corresponding forcing functions.</p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.create_input_data_on_disk-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.create_input_data_on_disk-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.create_input_data_on_disk</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_input_data_on_disk(config::AbstractConfig; direction::String=&quot;forward&quot;)</code></pre><p>Prepares a new JLD2 file on disk with the time-filtered data for a forward or backward Lagrangian simulation.</p><p>This function performs the following steps:</p><ol><li><strong>Validates <code>direction</code></strong>: Ensures the direction is either <code>&quot;forward&quot;</code>  or <code>&quot;backward&quot;</code>.</li><li><strong>Creates a new file</strong>: A new JLD2 file is created with the suffix  <code>_filter_input.jld2</code> and any existing file with the same name is deleted.</li><li><strong>Copies metadata</strong>: Key metadata from the original file (e.g., <code>grid</code>  information) is copied to the new file to maintain consistency.</li><li><strong>Time truncation</strong>: The data is truncated to the time range specified by  <code>config.T_start</code> and <code>config.T_end</code>.</li><li><strong>Time shifting</strong>:<ul><li>For <code>&quot;forward&quot;</code> filtering, a new time variable is created, shifted so   that <code>t=0</code> corresponds to <code>config.T_start</code>.</li><li>For <code>&quot;backward&quot;</code> filtering, the data is re-ordered and a new time   variable is created, shifted so that <code>t=0</code> corresponds to <code>config.T_end</code>.</li></ul></li><li><strong>Velocity reversal</strong>: For <code>&quot;backward&quot;</code> filtering, the velocity fields  (<code>u</code>, <code>v</code>, <code>w</code>) are negated to correctly simulate backward advection.</li></ol><p><strong>Arguments</strong></p><ul><li><code>config</code>: An instance of <code>AbstractConfig</code> containing the file paths, variable names, and time specifications.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>direction</code>: A <code>String</code> indicating the simulation direction. It must be either <code>&quot;forward&quot;</code> (the default) or <code>&quot;backward&quot;</code>.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.create_original_vars-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.create_original_vars-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.create_original_vars</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_original_vars(config::AbstractConfig)</code></pre><p>Creates a <code>NamedTuple</code> of <code>CenterField</code>s to serve as auxiliary fields for the original variables in a simulation. The fields are instantiated on the <code>grid</code> specified in the <code>config</code> object.</p><p><strong>Arguments</strong></p><ul><li><code>config</code>: An instance of <code>AbstractConfig</code> containing the names of the variables and the simulation grid.</li></ul><p><strong>Returns</strong></p><p>A <code>NamedTuple</code> where each key is a <code>Symbol</code> of a variable name to be filtered, and each value is an empty <code>CenterField</code> for that variable.</p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.create_output_fields-Tuple{Oceananigans.AbstractModel, OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.create_output_fields-Tuple{Oceananigans.AbstractModel, OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.create_output_fields</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_output_fields(model::AbstractModel, config::AbstractConfig)</code></pre><p>Reconstructs the final output fields from the model&#39;s tracers and auxiliary fields. This function performs the following steps:</p><ol><li><strong>Reconstructs filtered variables</strong>: For each variable to be filtered, it sums  the contributions from the individual filter coefficients (<code>_C</code> and <code>_S</code>  tracers) using the coefficients from <code>filter_params</code>.</li><li><strong>Reconstructs spatial mapping fields</strong>: If spatial mapping is enabled,  the function also reconstructs the <code>xi_</code> fields that represent the filtered  position.</li><li><strong>Builds mean velocities</strong>: If <code>compute_mean_velocities</code> is true, the function  reconstructs the mean velocity fields using the <code>xi_</code> fields.</li><li><strong>Includes original data</strong>: The original data is added to the output  dictionary for comparison and analysis if <code>config.output_original_data</code>  is true.</li></ol><p><strong>Arguments</strong></p><ul><li><code>model</code>: An instance of an <code>AbstractModel</code> containing the tracer and auxiliary fields.</li><li><code>config</code>: An instance of <code>AbstractConfig</code> with the names of the variables, velocity components, and filter parameters.</li></ul><p><strong>Returns</strong></p><p>A <code>Dict</code> where keys are the names of the output fields (e.g., <code>var_name_Lagrangian_filtered</code>, <code>xi_vel_name</code>, <code>var_name</code>) and values are the corresponding reconstructed <code>Field</code>s.</p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.get_frequency_response-Tuple{AbstractArray, NamedTuple}" href="#OceananigansLagrangianFilter.Utils.get_frequency_response-Tuple{AbstractArray, NamedTuple}"><code>OceananigansLagrangianFilter.Utils.get_frequency_response</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_frequency_response(freq::AbstractArray, filter_params::NamedTuple)</code></pre><p>Calculates the frequency response of the offline filter. This function takes a set of frequencies and the filter&#39;s coefficients to compute how the filter amplifies or attenuates different frequency components of a signal.</p><p>The response is computed by summing the contributions of each coefficient pair based on the filter&#39;s transfer function in the frequency domain. The result is a measure of the filter&#39;s gain at each given frequency.</p><p><strong>Arguments</strong></p><ul><li><code>freq</code>: A vector of frequencies (in radians per unit time).</li><li><code>filter_params</code>: A <code>NamedTuple</code> containing the filter coefficients (<code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>) and the number of coefficient pairs (<code>N_coeffs</code>).</li></ul><p><strong>Returns</strong></p><ul><li>A vector <code>Ghat</code> representing the filter&#39;s frequency response at each corresponding frequency in <code>freq</code>.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.get_weight_function-Tuple{}" href="#OceananigansLagrangianFilter.Utils.get_weight_function-Tuple{}"><code>OceananigansLagrangianFilter.Utils.get_weight_function</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_weight_function(;t::AbstractArray, tref::Real, filter_params::NamedTuple, direction::String = &quot;both&quot;)</code></pre><p>Computes the weighting function for the offline filter. This function calculates the filter&#39;s impulse response, which determines how much each point in the timeseries <code>t</code> contributes to the filtered value at a reference time <code>tref</code>. The weighting function is based on the provided <code>filter_params</code>, which contains the coefficients for the filter&#39;s impulse response.</p><p><strong>Keyword arguments</strong></p><ul><li><code>t</code>: A collection of time points in the timeseries.</li><li><code>tref</code>: The reference time at which the filter is being evaluated.</li><li><code>filter_params</code>: A <code>NamedTuple</code> containing the coefficients (<code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>) and the number of coefficient pairs (<code>N_coeffs</code>).</li><li><code>direction</code>: A <code>String</code> indicating the direction of the filter. It can be &quot;both&quot; (default), &quot;forward&quot;, or &quot;backward&quot;. This determines whether the filter is applied symmetrically around <code>tref</code>, only to past times, or only to future times.</li></ul><p><strong>Returns</strong></p><ul><li>A vector of weights <code>G</code>, with the same dimensions as <code>t</code>, representing the value of the filter&#39;s impulse response at each time point relative to <code>tref</code>.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.initialise_filtered_vars_from_data-Tuple{Oceananigans.AbstractModel, NamedTuple, OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.initialise_filtered_vars_from_data-Tuple{Oceananigans.AbstractModel, NamedTuple, OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.initialise_filtered_vars_from_data</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">initialise_filtered_vars_from_data(model::AbstractModel, saved_original_vars::Tuple,
                         config::AbstractConfig)</code></pre><p>Initializes the model&#39;s tracer fields, which represent the components of the filtered variables. This function sets the initial values of the filtered variables to the (scaled) first timestep of the original data. This improves the &quot;spin-up&quot; of the filter simulation by providing a good starting point.</p><p>The initialization formula depends on the number of filter coefficients (<code>N_coeffs</code>):</p><ul><li>For a <strong>single-exponential filter</strong> (<code>N_coeffs = 0.5</code>), only the <code>_C1</code> tracer exists and is initialized.</li><li>For a <strong>multi-coefficient filter</strong> (<code>N_coeffs &gt; 0.5</code>), both the <code>_C</code> and <code>_S</code> tracers for each coefficient are initialized.</li></ul><p><strong>Arguments</strong></p><ul><li><code>model</code>: The <code>AbstractModel</code> whose tracers are to be initialized.</li><li><code>saved_original_vars</code>: A <code>Tuple</code> of <code>FieldTimeSeries</code> objects containing the original data for each variable.</li><li><code>config</code>: An instance of <code>AbstractConfig</code> with the filter parameters.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.initialise_filtered_vars_from_model-Tuple{Oceananigans.AbstractModel, OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.initialise_filtered_vars_from_model-Tuple{Oceananigans.AbstractModel, OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.initialise_filtered_vars_from_model</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">initialise_filtered_vars_from_model(model::AbstractModel,config::AbstractConfig)</code></pre><p>Initializes the model&#39;s filtered tracer fields using the actual tracer fields that are assumed to have been already set. This improves the &quot;spin-up&quot; of the filter simulation  by providing a good starting point.</p><p>The initialization formula depends on the number of filter coefficients (<code>N_coeffs</code>):</p><ul><li>For a <strong>single-exponential filter</strong> (<code>N_coeffs = 0.5</code>), only the <code>_C1</code> tracer exists and is initialized.</li><li>For a <strong>multi-coefficient filter</strong> (<code>N_coeffs &gt; 0.5</code>), both the <code>_C</code> and <code>_S</code> tracers for each coefficient are initialized.</li></ul><p><strong>Arguments</strong></p><ul><li><code>model</code>: The <code>AbstractModel</code> whose tracers are to be initialized.</li><li><code>config</code>: An instance of <code>AbstractConfig</code> with the filter parameters.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.jld2_to_netcdf-Tuple{String, String}" href="#OceananigansLagrangianFilter.Utils.jld2_to_netcdf-Tuple{String, String}"><code>OceananigansLagrangianFilter.Utils.jld2_to_netcdf</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">jld2_to_netcdf(jld2_filename::String, nc_filename::String)</code></pre><p>Converts a JLD2 output file generated by an Oceananigans simulation into a standard NetCDF file. This function is useful for post-processing and for sharing data with other tools that expect the NetCDF format.</p><p>The conversion process involves the following steps:</p><ol><li><strong>Read JLD2 data</strong>: Opens the input JLD2 file and reads the grid, time,  and all timeseries variables.</li><li><strong>Create NetCDF file</strong>: Creates a new NetCDF file with a <code>.nc</code> extension.</li><li><strong>Define dimensions</strong>: Defines NetCDF dimensions based on the grid sizes  and staggered locations (e.g., <code>x_caa</code> for cell centers, <code>x_faa</code> for  cell faces).</li><li><strong>Define grid variables</strong>: Writes the grid coordinates and metadata  (e.g., <code>Lx</code>, <code>Ny</code>, <code>Hx</code>) as variables to the NetCDF file.</li><li><strong>Write timeseries data</strong>: Iterates through each variable in the JLD2  file&#39;s timeseries, determines its location on the grid, and writes the  data to a new variable in the NetCDF file.</li><li><strong>Add metadata</strong>: Adds attributes to each variable, including boundary  conditions and units, for better documentation.</li></ol><p><strong>Arguments</strong></p><ul><li><code>jld2_filename</code>: A <code>String</code> specifying the path to the input JLD2 file.</li><li><code>nc_filename</code>: A <code>String</code> specifying the path for the output NetCDF file.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.load_data-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.load_data-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.load_data</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">load_data(config::AbstractConfig)</code></pre><p>Loads the velocity and tracer data from the intermediate input file created by <code>create_input_data_on_disk</code>. The data for each variable is loaded as a <code>FieldTimeSeries</code> and returned as a single <code>NamedTuple</code>.</p><p><strong>Arguments</strong></p><ul><li><code>config</code>: An instance of <code>AbstractConfig</code> containing the file path, variable names, </li></ul><p>architecture, and backend.</p><p><strong>Returns</strong></p><p>A <code>NamedTuple</code> with fields <code>velocity_data</code> and <code>var_data</code>, where each field contains a <code>Tuple</code> of <code>FieldTimeSeries</code> objects.</p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.regrid_to_mean_position!-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.regrid_to_mean_position!-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.regrid_to_mean_position!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">regrid_to_mean_position!(config::AbstractConfig)</code></pre><p>Regrids the filtered data to the mean position. This function reads the combined  output file, interpolates the filtered variables to the mean position, and saves the result in new variables within the same file.</p><p>The regridding process involves the following steps:</p><ol><li><strong>Extracts positions</strong>: The mean positions (<code>xi_u</code>, <code>xi_v</code>, <code>xi_w</code>) and  filtered variable data are extracted for each time step.</li><li><strong>Handles periodicity</strong>: For periodic dimensions (x, y, or z), the data is  padded by repeating values near the boundaries to ensure accurate  interpolation across the periodic boundaries.</li><li><strong>Interpolates data</strong>: A linear interpolator is used to map the filtered data  from the irregular advected positions to the original, regular grid points.</li><li><strong>Saves new fields</strong>: The regridded data is saved as new variables in the  combined output file, with a <code>_Lagrangian_filtered_at_mean</code> suffix.</li></ol><p><strong>Arguments</strong></p><ul><li><code>config</code>: An instance of <code>AbstractConfig</code> containing the file paths, variable names, and grid information.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.set_offline_BW2_filter_params-Tuple{}" href="#OceananigansLagrangianFilter.Utils.set_offline_BW2_filter_params-Tuple{}"><code>OceananigansLagrangianFilter.Utils.set_offline_BW2_filter_params</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_offline_BW2_filter_params(; N::Int=1, freq_c::Real=1)</code></pre><p>Calculates the coefficients for a filter that has a frequency response given by a Butterworth filter with order <code>N</code> and cutoff frequency <code>freq_c</code>, squared. </p><p>Uses <code>N</code> exponentials and <code>N/2</code> sets of coefficients (a,b,c,d). N should therefore be even, since exponentials come in pairs to ensure a real-valued filter.</p><p>However, the special case N=1 is allowed, which gives a single (real) exponential filter.</p><p>Frequency response: <code>Ghat(omega) = 1 / (1 + (omega / freq_c)^(2*N))</code> Real filter shape: <code>G(t) = sum_{i=1}^{N/2} exp(-c_i*abs(t))*(a_i*cos(d_i * abs(t)) + b_i*sin(d_i * abs(t)))</code></p><p>This function supports two types of filters:</p><ul><li>A <strong>single exponential filter</strong> when <code>N=1</code>. This is a special case that generates two coefficients instead of 4. The unidirectional filter is a single exponential, and <code>N_coeffs = 0.5</code>. Only <code>a1</code> and <code>c1</code> are returned.</li><li>A <strong>Butterworth squared filter</strong> for <code>N&gt;1</code>. This generates <code>N/2</code> sets of coefficients (a,b,c,d), representing a filter of order <code>N</code>. The coefficients are computed based on the filter&#39;s order and cutoff frequency.</li></ul><p><strong>Arguments</strong></p><ul><li><code>N</code>: The order parameter for the filter. <code>N=1</code> for a single exponential. For <code>N&gt;1</code>, the filter&#39;s order is <code>N</code>. Must be a non-negative even integer.</li><li><code>freq_c</code>: The cutoff frequency of the filter. Must be a real number.</li></ul><p><strong>Returns</strong></p><ul><li>A <code>NamedTuple</code> containing the filter coefficients and <code>N_coeffs</code>, the number of coefficient pairs.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.set_online_BW_filter_params-Tuple{}" href="#OceananigansLagrangianFilter.Utils.set_online_BW_filter_params-Tuple{}"><code>OceananigansLagrangianFilter.Utils.set_online_BW_filter_params</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_online_BW_filter_params(; N::Int=1, freq_c::Real=1)</code></pre><p>Calculates the coefficients for a filter that has a frequency response given by a Butterworth filter with order <code>N</code> and cutoff frequency <code>freq_c</code>. Note that the frequency response is not squared, like in the offline forward-backward filter, and the frequency response is not real-valued, implying a nonlinear phase shift. </p><p>Uses <code>N</code> exponentials and <code>N/2</code> sets of coefficients (a,b,c,d). N should therefore be even, since exponentials come in pairs to ensure a real-valued filter.</p><p>However, the special case N=1 is allowed, which gives a single (real) exponential filter.</p><p>Frequency response: <code>abs(Ghat(omega)) = 1 / sqrt(1 + (omega / freq_c)^(2*N))</code> Real filter shape: <code>G(t) = sum_{i=1}^{N/2} exp(-c_i*t)* (a_i*cos(d_i * t) + b_i*sin(d_i * t))</code>  for t&gt;=0, and 0 for t&lt;0.</p><p>This function supports two types of filters:</p><ul><li>A <strong>single exponential filter</strong> when <code>N=1</code>. This is a special case that generates two coefficients instead of 4. The unidirectional filter is a single exponential, and <code>N_coeffs = 0.5</code>. Only <code>a1</code> and <code>c1</code> are returned.</li><li>A <strong>Butterworth filter</strong> for <code>N&gt;1</code>. This generates <code>N/2</code> sets of coefficients (a,b,c,d), representing a filter of order <code>N</code>. The coefficients are computed based on the filter&#39;s order and cutoff frequency.</li></ul><p><strong>Arguments</strong></p><ul><li><code>N</code>: The order parameter for the filter. <code>N=1</code> for a single exponential. For <code>N&gt;1</code>, the filter&#39;s order is <code>N</code>. Must be a non-negative even integer.</li><li><code>freq_c</code>: The cutoff frequency of the filter. Must be a real number.</li></ul><p><strong>Returns</strong></p><ul><li>A <code>NamedTuple</code> containing the filter coefficients and <code>N_coeffs</code>, the number of coefficient pairs.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.sum_forward_backward_contributions!-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.sum_forward_backward_contributions!-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.sum_forward_backward_contributions!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sum_forward_backward_contributions!(config::AbstractConfig)</code></pre><p>Combines the output from the forward and backward filter simulations into a single output file. This function performs the final step of the offline filter algorithm by summing the contributions from each pass.</p><p>The function performs the following steps:</p><ol><li><strong>Initializes the combined file</strong>: A new JLD2 file is created to store  the final output.</li><li><strong>Copies metadata and unfiltered data</strong>: The file structure, metadata,  and the original, unfiltered data are copied from the forward output file.</li><li><strong>Sums filtered contributions</strong>: For each filtered variable, the data  from the backward output file is loaded as a <code>FieldTimeSeries</code>. The data  is then interpolated to match the time steps of the forward simulation,  and the two datasets are summed and written to the combined output file.</li></ol><p><strong>Arguments</strong></p><ul><li><code>config</code>: An instance of <code>AbstractConfig</code> containing the file paths and variable names.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.update_input_data!-Tuple{Simulation, NamedTuple}" href="#OceananigansLagrangianFilter.Utils.update_input_data!-Tuple{Simulation, NamedTuple}"><code>OceananigansLagrangianFilter.Utils.update_input_data!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">update_input_data!(sim::Simulation, input_data::NamedTuple)</code></pre><p>Updates the velocity and auxiliary fields of a simulation at the current simulation time <code>t</code>. This function is designed to be used as a callback in an Oceananigans <code>Simulation</code>.</p><p>The function performs two main tasks:</p><ol><li><strong>Updates velocities</strong>: It sets the <code>u</code>, <code>v</code>, and <code>w</code> velocity fields of  the <code>model</code> to the corresponding data from the <code>velocity_data</code>  <code>FieldTimeSeries</code> at the current simulation time.</li><li><strong>Updates auxiliary fields</strong>: It updates the auxiliary fields of the  <code>model</code> with the original data from the <code>var_data</code> <code>FieldTimeSeries</code>, which  are used for forcing terms.</li></ol><p><strong>Arguments</strong></p><ul><li><code>sim</code>: The <code>Simulation</code> object.</li><li><code>input_data</code>: A <code>NamedTuple</code> containing <code>velocity_data</code> and <code>var_data</code>, where each field is a <code>Tuple</code> of <code>FieldTimeSeries</code> objects.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="OceananigansLagrangianFilter.Utils.zero_closure_for_filtered_vars-Tuple{OceananigansLagrangianFilter.AbstractConfig}" href="#OceananigansLagrangianFilter.Utils.zero_closure_for_filtered_vars-Tuple{OceananigansLagrangianFilter.AbstractConfig}"><code>OceananigansLagrangianFilter.Utils.zero_closure_for_filtered_vars</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zero_closure_for_filtered_vars(config::AbstractConfig)</code></pre><p>Initializes the model&#39;s filtered tracer fields using the actual tracer fields that are assumed to have been already set. This improves the &quot;spin-up&quot; of the filter simulation  by providing a good starting point.</p><p>The initialization formula depends on the number of filter coefficients (<code>N_coeffs</code>):</p><ul><li>For a <strong>single-exponential filter</strong> (<code>N_coeffs = 0.5</code>), only the <code>_C1</code> tracer exists and is initialized.</li><li>For a <strong>multi-coefficient filter</strong> (<code>N_coeffs &gt; 0.5</code>), both the <code>_C</code> and <code>_S</code> tracers for each coefficient are initialized.</li></ul><p><strong>Arguments</strong></p><ul><li><code>model</code>: The <code>AbstractModel</code> whose tracers are to be initialized.</li><li><code>config</code>: An instance of <code>AbstractConfig</code> with the filter parameters.</li></ul></div></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../references/">« References</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Wednesday 29 October 2025 18:24">Wednesday 29 October 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
